---
layout: post
title:  "Register"
date:   2021-01-01 12:00:00 +0800
categories: [HW]
excerpt: Register.
tags:
  - Register
---

![](https://gitee.com/BiscuitOS_team/PictureSet/raw/Gitee/BiscuitOS/kernel/IND00000L0.PNG)

#### 目录

> - [X86 Control Register](#R03)
>
>   - [CR0](#R00)
>
>   - [CR3](#R02)
>
>   - [CR4](#R01)
>
> - [X86 EFLAGS Register](#M)
>
> - [X86 MSR](#T001)
>
>   - [IA32_EFER MSR](#T000)
>
> - [CPUID](#C)
>
>   - [CPUID.01H](#C01M)
>
>   - [CPUID.80000008H](#C02M)

![](https://gitee.com/BiscuitOS_team/PictureSet/raw/Gitee/BiscuitOS/kernel/IND000100.png)

-------------------------------------------

#### <span id="R02">X86 CR3 Control Register</span>

![](https://gitee.com/BiscuitOS_team/PictureSet/raw/Gitee/HK/HK000985.png)

> [CR3 With 32Bit Paging](#R02M00)
>
> [CR3 Register BiscuitOS 实践](#R02MX)
> 
> [Intel Software Development Vol2.3.2 CPUID](https://gitee.com/BiscuitOS_team/Documentation/blob/master/Datasheet/Intel/Intel-IA32_DevelopmentManual.pdf)

--------------------------------------

###### <span id="R02M00">CR3 With 32Bit Paging</span>

![](https://gitee.com/BiscuitOS_team/PictureSet/raw/Gitee/HK/HK000986.png)

---------------------------------------------

###### <span id="R02MX">BiscuitOS 实践</span>

Intel CR3 寄存器在 BiscuitOS 中的实践如下:

{% highlight bash %}
cd BiscuitOS
make menuconfig

  [*] Package  --->
      [*] Register  --->
          [*] X86/i386/X64 Register  --->
              [*] CR3 Register  --->
                  [*] X86 CR3 Register (Common)  --->
{% endhighlight %}

> [CR3 Source Code](https://gitee.com/BiscuitOS_team/HardStack/tree/Gitee/Architecture/Intel/Register/CR3/CR3-Default)

具体实践过程可以参考:

> [BiscuitOS 独立程序实践教程](https://biscuitos.github.io/blog/Human-Knowledge-Common/#C)

程序在 BiscuitOS 运行效果如下:

![](https://gitee.com/BiscuitOS_team/PictureSet/raw/Gitee/HK/HK000987.png)

![](https://gitee.com/BiscuitOS_team/PictureSet/raw/Gitee/BiscuitOS/kernel/IND000100.png)


-------------------------------------------

#### <span id="C">X86 CPUID Register</span>

> [CPUID.01H](#C01M)
>
> [CPUID Register BiscuitOS 实践](#CMM)
> 
> [Intel Software Development Vol2.3.2 CPUID](https://gitee.com/BiscuitOS_team/Documentation/blob/master/Datasheet/Intel/Intel-IA32_DevelopmentManual.pdf)

------------------------------------

###### <span id="C02M">CPUID.80000008H</span>

![](https://gitee.com/BiscuitOS_team/PictureSet/raw/Gitee/HK/HK000983.png)

> [CPUID.01H Register BiscuitOS 实践](#C02M03)

---------------------------------------------

###### <span id="C02M03">BiscuitOS 实践</span>

Intel CPUID.80000008H 寄存器在 BiscuitOS 中的实践如下:

{% highlight bash %}
cd BiscuitOS
make menuconfig

  [*] Package  --->
      [*] Register  --->
          [*] X86/i386/X64 Register  --->
              [*] CPUID  --->
                  [*] X86 CPUID Register  --->
                      [*] CPUID.80000008H Register  --->
                          [*] X86 CPUID.80000008H Register  --->
{% endhighlight %}

> [CPUID.80000008H Source Code](https://gitee.com/BiscuitOS_team/HardStack/tree/Gitee/Architecture/Intel/Register/CPUID/CPUID.80000008H/Default)

具体实践过程可以参考:

> [BiscuitOS 独立程序实践教程](https://biscuitos.github.io/blog/Human-Knowledge-Common/#C)

程序在 BiscuitOS 运行效果如下:

![](https://gitee.com/BiscuitOS_team/PictureSet/raw/Gitee/HK/HK000984.png)

![](https://gitee.com/BiscuitOS_team/PictureSet/raw/Gitee/BiscuitOS/kernel/IND000100.png)

------------------------------------

###### <span id="C01M">CPUID.01H</span>

![](https://gitee.com/BiscuitOS_team/PictureSet/raw/Gitee/HK/HK000974.png)

> [EAX](#C01M00)
>
> [ECX](#C01M01)
>
> [EDX](#C01M02)
>
> [CPUID.01H Register BiscuitOS 实践](#C01M03)

----------------------------------

###### <span id="C01M00">EAX</span>

![](https://gitee.com/BiscuitOS_team/PictureSet/raw/Gitee/HK/HK000981.png)

----------------------------------

###### <span id="C01M01">ECX</span>

![](https://gitee.com/BiscuitOS_team/PictureSet/raw/Gitee/HK/HK000975.png)

![](https://gitee.com/BiscuitOS_team/PictureSet/raw/Gitee/HK/HK000976.png)

![](https://gitee.com/BiscuitOS_team/PictureSet/raw/Gitee/HK/HK000977.png)

---------------------------------

###### <span id="C01M02">EDX</span>

![](https://gitee.com/BiscuitOS_team/PictureSet/raw/Gitee/HK/HK000978.png)

![](https://gitee.com/BiscuitOS_team/PictureSet/raw/Gitee/HK/HK000979.png)

![](https://gitee.com/BiscuitOS_team/PictureSet/raw/Gitee/HK/HK000980.png)

---------------------------------------------

###### <span id="C01M03">BiscuitOS 实践</span>

Intel CPUID.01H 寄存器在 BiscuitOS 中的实践如下:

{% highlight bash %}
cd BiscuitOS
make menuconfig

  [*] Package  --->
      [*] Register  --->
          [*] X86/i386/X64 Register  --->
              [*] CPUID  --->
                  [*] X86 CPUID Register  --->
                      [*] CPUID.01H Register  --->
                          [*] X86 CPUID.01H Register  --->
{% endhighlight %}

> [CPUID.01H Source Code](https://gitee.com/BiscuitOS_team/HardStack/tree/Gitee/Architecture/Intel/Register/CPUID/CPUID-0x1H/Default)

具体实践过程可以参考:

> [BiscuitOS 独立程序实践教程](https://biscuitos.github.io/blog/Human-Knowledge-Common/#C)

程序在 BiscuitOS 运行效果如下:

![](https://gitee.com/BiscuitOS_team/PictureSet/raw/Gitee/HK/HK000982.png)

![](https://gitee.com/BiscuitOS_team/PictureSet/raw/Gitee/BiscuitOS/kernel/IND000100.png)

---------------------------------------------

###### <span id="CMM">BiscuitOS 实践</span>

Intel CPUID 寄存器在 BiscuitOS 中的实践如下:

{% highlight bash %}
cd BiscuitOS
make menuconfig

  [*] Package  --->
      [*] Register  --->
          [*] X86/i386/X64 Register  --->
              [*] CPUID  --->
                  [*] X86 CPUID Register  --->
{% endhighlight %}

> [CPUID Source Code](https://gitee.com/BiscuitOS_team/HardStack/tree/Gitee/Architecture/Intel/Register/CPUID/CPUID-Default)

具体实践过程可以参考:

> [BiscuitOS 独立程序实践教程](https://biscuitos.github.io/blog/Human-Knowledge-Common/#C)

程序在 BiscuitOS 运行效果如下:

![](https://gitee.com/BiscuitOS_team/PictureSet/raw/Gitee/HK/HK000973.png)

![](https://gitee.com/BiscuitOS_team/PictureSet/raw/Gitee/BiscuitOS/kernel/IND000100.png)

-------------------------------------------

#### <span id="M">X86 EFLAGS Register</span>

![](https://gitee.com/BiscuitOS_team/PictureSet/raw/Gitee/HK/HK000969.png)

X86 EFLAGS Register 包含了一组状态、控制和系统标志。

> [EFLAGS.AC](#M00)
>
> [EFLAGS Register BiscuitOS 实践](#M0A)
> 
> [Intel Software Development Vol3 2.2.1](https://gitee.com/BiscuitOS_team/Documentation/blob/master/Datasheet/Intel/Intel-IA32_DevelopmentManual.pdf)

------------------------------------

###### <span id="M00">EFLAGS.AC</span>

![](https://gitee.com/BiscuitOS_team/PictureSet/raw/Gitee/HK/HK000970.png)

EFLAGS.AC 标志位用于指明 "对齐检测" 或 "访问控制". 当 CR0.AM 标志位置位，那么 AC 标志位用于表示 "对齐检测".

如果 CR4.SMAP 标志位置位，那么内核空间可以访问用户空间的数据.

> [CR4.SMAP](#R015)

---------------------------------------------

###### <span id="M0A">BiscuitOS 实践</span>

Intel EFLAGS 寄存器在 BiscuitOS 中的实践如下:

{% highlight bash %}
cd BiscuitOS
make menuconfig

  [*] Package  --->
      [*] Register  --->
          [*] X86/i386/X64 Register  --->
              [*] EFLAGS Register  --->
                  [*] X86 EFLAGS Register  --->
{% endhighlight %}

> [EFLAGS Register Source Code](https://gitee.com/BiscuitOS_team/HardStack/tree/Gitee/Architecture/Intel/Register/EFLAGS/default)

具体实践过程可以参考:

> [BiscuitOS 独立程序实践教程](https://biscuitos.github.io/blog/Human-Knowledge-Common/#C)

程序在 BiscuitOS 运行效果如下:

![](https://gitee.com/BiscuitOS_team/PictureSet/raw/Gitee/HK/HK000971.png)

![](https://gitee.com/BiscuitOS_team/PictureSet/raw/Gitee/BiscuitOS/kernel/IND000100.png)

-------------------------------------------

#### <span id="T000">IA32_EFER MSR</span>

![](https://gitee.com/BiscuitOS_team/PictureSet/raw/Gitee/HK/HK000966.png)

X86 IA32_EFER MSR 寄存器全称 "Extended Feature enable Register", 该寄存器提供了多个域与 IA-32e 模式的使能和操作相关，其中也包含了一个与 page-access 权限修改相关的域。

> [IA32_EFER.LME](#T0000)
>
> [IA32_EFER.NXE](#T0001)
>
> [IA32_EFER MSR Register BiscuitOS 实践](#T000A)
> 
> [Intel Software Development Vol3 2.2.1](https://gitee.com/BiscuitOS_team/Documentation/blob/master/Datasheet/Intel/Intel-IA32_DevelopmentManual.pdf)

------------------------------------

###### <span id="T0000">IA32_EFER.LME</span>

![](https://gitee.com/BiscuitOS_team/PictureSet/raw/Gitee/HK/HK000967.png)

IA32_EFER.LME 标志用于指明 IA-32e 模式是否激活. 当该标志置位，那么 IA-32 模式已经激活; 反之 IA-32e 模式没有激活.

------------------------------------

###### <span id="T0001">IA32_EFER.NXE</span>

![](https://gitee.com/BiscuitOS_team/PictureSet/raw/Gitee/HK/HK000967.png)

IA32_EFER.NXE 标志用于指明使能物理页的访问限制，如果该 bit 置位，那么系统会阻止 PAE 物理页在 XD 标志置位的情况下的指令预取.

-------------------------------------

###### <span id="T000A">BiscuitOS 实践</span>

Intel IA32_EFER MSR 寄存器在 BiscuitOS 中的实践如下:

{% highlight bash %}
cd BiscuitOS
make menuconfig

  [*] Package  --->
      [*] Register  --->
          [*] X86/i386/X64 Register  --->
              [*] MSR Register  --->
                  [*] MSR IA32_EFER  --->
{% endhighlight %}

> [MSR IA32_EFER Source Code](https://gitee.com/BiscuitOS_team/HardStack/tree/Gitee/Architecture/Intel/Register/MSR-IA32_EFER)

具体实践过程可以参考:

> [BiscuitOS 独立程序实践教程](https://biscuitos.github.io/blog/Human-Knowledge-Common/#C)

程序在 BiscuitOS 运行效果如下:

![](https://gitee.com/BiscuitOS_team/PictureSet/raw/Gitee/HK/HK000968.png)

![](https://gitee.com/BiscuitOS_team/PictureSet/raw/Gitee/BiscuitOS/kernel/IND000100.png)

-------------------------------------------

#### <span id="R01">CR4</span>

![](https://gitee.com/BiscuitOS_team/PictureSet/raw/Gitee/HK/HK000958.png)

X86 CR4 寄存器包含了一组标志，该标志用于使能体系 "拓展的" 且用于指明操作系统或执行程序所支持的处理器特殊能力。

> [CR4.PSE](#R010)
>
> [CR4.PAE](#R011)
>
> [CR4.PGE](#R012)
>
> [CR4.PCIDE](#R013)
>
> [CR4.SMEP](#R014)
>
> [CR4.SMAP](#R015)
>
> [CR4.PKE](#R016)
>
> [CR4 Register BiscuitOS 实践](#R01A)
> 
> [Intel Software Development Vol3 2.5](https://gitee.com/BiscuitOS_team/Documentation/blob/master/Datasheet/Intel/Intel-IA32_DevelopmentManual.pdf)

------------------------------------

###### <span id="R010">CR4.PSE</span>

![](https://gitee.com/BiscuitOS_team/PictureSet/raw/Gitee/HK/HK000959.png)

CR4.PSE 标志用于指明 32-bit 系统分页是否支持 4MB 物理页的映射。如果该标志位置位，那么在 32-bit 系统里，PTE 可以指向一块 4MB 的物理页; 反之该标志位清零，那么在 32-bit 系统中 PTE 只能映射 4KB 的物理页.

------------------------------------

###### <span id="R011">CR4.PAE</span>

![](https://gitee.com/BiscuitOS_team/PictureSet/raw/Gitee/HK/HK000960.png)

CR4.PAE 标志用于指明系统是否支持物理地址拓展。当该标志位置位，那么分页的时候使用超过 32 bit 的物理地址; 反之，当该标志位清零的时候，物理地址只能是 32 bit。当系统进入 IA-32e 模式之前，CR4.PAE 表示为必须使能。

------------------------------------

###### <span id="R012">CR4.PGE</span>

![](https://gitee.com/BiscuitOS_team/PictureSet/raw/Gitee/HK/HK000961.png)

CR4.PGE 标志用于指明是否支持全局页特性。如果该标志位使能，那么系统支持全局页属性; 反之不支持全局页属性。全局页属性允许所有的用户频繁使用或共享 PTE/PDE 中 "Global" 标志位置位的页。全局页特点包括当 Task 切换或者更新 CR3 的值不会引起全局页从 TLB 中刷出. 当系统需要使能 CR4.PGE 标志，那么 CR0.PG 必须使能。

------------------------------------

###### <span id="R013">CR4.PCIDE</span>

![](https://gitee.com/BiscuitOS_team/PictureSet/raw/Gitee/HK/HK000962.png)

CR4.PCIDE 标志用于指明是否支持处理器上下文标识. 当该标志位置位，那么系统支持 PCIDs 功能; 反之系统不支持 PCIDs 功能.

------------------------------------

###### <span id="R014">CR4.SMEP</span>

![](https://gitee.com/BiscuitOS_team/PictureSet/raw/Gitee/HK/HK000963.png)

CR4.SMEP 标志用于指明系统是否支持阻止 "超级用户执行" 的能力。如果该标志位置位，那么系统可能阻止超级用户执行的动作.

------------------------------------

###### <span id="R015">CR4.SMAP</span>

![](https://gitee.com/BiscuitOS_team/PictureSet/raw/Gitee/HK/HK000964.png)

CR4.SMAP 标志用于指明系统是否支持阻止 "超级用户访问" 的能力. 如果该标志位置位，那么系统可能阻止超级用户访问的动作.

------------------------------------

###### <span id="R015">CR4.PKE</span>

![](https://gitee.com/BiscuitOS_team/PictureSet/raw/Gitee/HK/HK000965.png)

CR4.PKE 标志用于指明系统是否支持在 4-level 分页时附带一个 "Protection key". PKRU 寄存器指明用户的线性地址的 "Protection key" 是否可读写.

-------------------------------------

###### <span id="R01A">BiscuitOS 实践</span>

Intel X86 CR4 寄存器在 BiscuitOS 中的实践如下:

{% highlight bash %}
cd BiscuitOS
make menuconfig

  [*] Package  --->
      [*] Register  --->
          [*] X86/i386/X64 Register  --->
              [*] CR4 Control Register  --->
{% endhighlight %}

> [CR0 Control Register Source Code](https://gitee.com/BiscuitOS_team/HardStack/tree/Gitee/Architecture/Intel/Register/CR0)

具体实践过程可以参考:

> [BiscuitOS 独立程序实践教程](https://biscuitos.github.io/blog/Human-Knowledge-Common/#C)

程序在 BiscuitOS 运行效果如下:

![](https://gitee.com/BiscuitOS_team/PictureSet/raw/Gitee/HK/HK000950.png)

![](https://gitee.com/BiscuitOS_team/PictureSet/raw/Gitee/BiscuitOS/kernel/IND000100.png)

-------------------------------------------

#### <span id="R00">CR0</span>

![](https://gitee.com/BiscuitOS_team/PictureSet/raw/Gitee/HK/HK000954.png)

X86 CR0 寄存器包含了用于控制处理器的操作模式和状态的系统控制标志。其长度为 32 bit，每个标志位的作用将左右操作系统的行为和状态.

> [CR0.PG](#R000)
>
> [CR0.PE](#R001)
>
> [CR0.WP](#R002)
>
> [CR0 Register BiscuitOS 实践](#R00A)
> 
> [Intel Software Development Vol3 2.5](https://gitee.com/BiscuitOS_team/Documentation/blob/master/Datasheet/Intel/Intel-IA32_DevelopmentManual.pdf)

------------------------------------

###### <span id="R000">CR0.PG</span>

![](https://gitee.com/BiscuitOS_team/PictureSet/raw/Gitee/HK/HK000955.png)

CR0.PG 标志位用于使能系统的分页机制. 如果 CR0.PG 置位，那么系统支持分页，此时线性地址不是虚拟地址; 反之 CR0.PG 清零，那么系统不支持分页，此时线性地址就是物理地址. CR0.PG 标志位的变化不受 CR0.PE 标志位的影响，但当 CR0.PE 标志位清零的时候，将 CR0.PG 标志位置位将引起一个 #GP 错误, 也就是系统没有进入保护模式的时候，系统开启分页将引起一个 "general-protection exception (#GP)".

------------------------------------

###### <span id="R001">CR0.PE</span>

![](https://gitee.com/BiscuitOS_team/PictureSet/raw/Gitee/HK/HK000956.png)

CR0.PE 标志位用于使能系统的保护模式. 如果 CR0.PE 置位，那么系统进入保护模式; 如果 CR0.PE 清零，那么系统进入实时模式。CR0.PE 的使能不能直接启用系统的分页功能，需要再将 CR0.PG 置位，并且 CR0.PE 的使能只提供了 Segment 级别的保护.

------------------------------------

###### <span id="R002">CR0.WP</span>

![](https://gitee.com/BiscuitOS_team/PictureSet/raw/Gitee/HK/HK000957.png)

CR0.WP 用于使能写保护机制。当 CR0.WP 置位，那么系统会阻止超级权限的程序去写只读的物理页; 反之当 CR0.WP 清零，那么系统允许超级权限的程序对只读物理页进行写操作。

-------------------------------------

###### <span id="R00A">BiscuitOS 实践</span>

Intel X86 CR0 寄存器在 BiscuitOS 中的实践如下:

{% highlight bash %}
cd BiscuitOS
make menuconfig

  [*] Package  --->
      [*] Register  --->
          [*] X86/i386/X64 Register  --->
              [*] CR0 Control Register  --->
{% endhighlight %}

> [CR0 Control Register Source Code](https://gitee.com/BiscuitOS_team/HardStack/tree/Gitee/Architecture/Intel/Register/CR0)

具体实践过程可以参考:

> [BiscuitOS 独立程序实践教程](https://biscuitos.github.io/blog/Human-Knowledge-Common/#C)

程序在 BiscuitOS 运行效果如下:

![](https://gitee.com/BiscuitOS_team/PictureSet/raw/Gitee/HK/HK000950.png)

![](https://gitee.com/BiscuitOS_team/PictureSet/raw/Gitee/BiscuitOS/kernel/IND000100.png)

